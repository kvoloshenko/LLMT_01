@startuml
title "Bot Factory"
hide footbox


participant Application as s
participant "Google Drive" as drive
participant CharacterTextSplitter as splitter
database    "Индексная DB" as db
participant ChatGPT as chat

-> s : POST create_db(knowledge_base_url, ba)
drive <- s: Загрузка файла с Базой Знаний
s -> splitter: Разбиение Базы Знаний на чанки
s <-- splitter: source_chunks
s -> db: Создание индексной базы (source_chunks)
db -> db: Перевод чанков Базы Знаний в эмбеддинги
s -> db: save_local(ba)
s <-- db: db_file

-> s : POST chat(topic, ba)
drive <- s: Загрузка файла с Промтом
s -> db: load_local(ba, db_file)
s -> db: Поиск релевантных чанков(topic, количество)
s <-- db: message_content
s -> chat: Запрос ChatGPT (Промт, message_content, температура)
note right
  Примечание:
  * Промт определяет базовую
  инструкцию для ChatGPT
  * message_content содержит
  вопрос и релевантные чанки
  * Температура управляет степенью
случайности выходных данных
end note
s <-- chat: ответ


@enduml